<!DOCTYPE html>
<html>

<head>
    <title>Game Loop Test</title>
    <style>
        #gameCanvas {
            width: 400px;
            height: 300px;
            border: 2px solid black;
            transition: background-color 0.2s;
        }

        #debugInfo {
            font-family: monospace;
            margin-top: 20px;
            padding: 10px;
            background-color: #f0f0f0;
        }

        .stat {
            margin: 5px 0;
        }
    </style>
</head>

<body>
    <div id="gameCanvas"></div>
    <div id="debugInfo">
        <div class="stat">FPS: <span id="fpsCounter">0</span></div>
        <div class="stat">Frame Time: <span id="frameTime">0</span>ms</div>
        <div class="stat">Color State: <span id="colorState">0</span></div>
        <div class="stat">Current Color: <span id="currentColor">None</span></div>
    </div>

    <script>
        class Main {
            #gameCanvas;
            #lastTime = 0;
            #colorIndex = 0;
            #colorChangeInterval = 1000; // Change color every 1 second
            #accumulatedTime = 0;
            #frameCount = 0;
            #lastFpsUpdate = 0;
            #currentFps = 0;

            constructor() {
                this.#gameCanvas = document.getElementById('gameCanvas');
                this.#lastTime = performance.now();
                this.#lastFpsUpdate = this.#lastTime;
            }

            #updateDebugInfo() {
                document.getElementById('fpsCounter').textContent =
                    Math.round(this.#currentFps);
                document.getElementById('colorState').textContent =
                    this.#colorIndex;
                document.getElementById('currentColor').textContent =
                    this.#gameCanvas.style.backgroundColor || 'None';
            }

            #calculateFps(currentTime) {
                this.#frameCount++;

                const elapsed = currentTime - this.#lastFpsUpdate;
                if (elapsed >= 1000) { // Update FPS every second
                    this.#currentFps = (this.#frameCount * 1000) / elapsed;
                    this.#frameCount = 0;
                    this.#lastFpsUpdate = currentTime;
                }
            }

            #input() {
                // Process input - changes to red
                if (this.#colorIndex === 0) {
                    this.#gameCanvas.style.backgroundColor = 'red';
                }
            }

            #update(deltaTime) {
                // Update game state - changes to green
                this.#accumulatedTime += deltaTime;

                if (this.#accumulatedTime >= this.#colorChangeInterval) {
                    this.#colorIndex = (this.#colorIndex + 1) % 3;
                    this.#accumulatedTime = 0;
                }

                if (this.#colorIndex === 1) {
                    this.#gameCanvas.style.backgroundColor = 'green';
                }
            }

            #render() {
                // Render - changes to blue
                if (this.#colorIndex === 2) {
                    this.#gameCanvas.style.backgroundColor = 'blue';
                }
            }

            start(currentTime) {
                // Calculate delta time in milliseconds
                const deltaTime = currentTime - this.#lastTime;

                // Update frame time display
                document.getElementById('frameTime').textContent =
                    deltaTime.toFixed(2);

                // Calculate FPS
                this.#calculateFps(currentTime);

                // Run game loop steps
                this.#input();
                this.#update(deltaTime);
                this.#render();

                // Update debug information
                this.#updateDebugInfo();

                // Store current time for next frame
                this.#lastTime = currentTime;
            }
        }

        const mainGame = new Main();

        function gameLoop(currentTime) {
            mainGame.start(currentTime);
            requestAnimationFrame(gameLoop);
        }

        // Start the game loop
        requestAnimationFrame(gameLoop);
    </script>
</body>

</html>
